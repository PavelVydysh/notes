# Kafka

## Концепция указателей

- Кафка смаостоятельно может **менять лидеров**

- Для избежания потери сообщений:

  - `ack=all` - определяет, сколько реплик должны подтвердить получение сообщения, прежде чем оно будет считаться доставленным(на стороне продюссера).

    - `0` - не ждет пождтверждения
    - `1` - ждет подтверждения от лидера
    - `all` - ждет подтверждения от всех реплик

  - `min.insync.replicas` - минимальное кол-во синхронизированных реплик, которые должны подтвердить запись(на стороне брокера)

    При отправке сообщения, продюссер указывает, от скольких партиций он ожидает подтверждение

    Рекомендуется использовать `acks` совместно с `min.insync.replicas` и устанавливать `min.insync.replicas` хотя бы на 1 меньше чем количество реплик(`default.replication.factor`)

  - `unclean.leader.election.enabnled=true/false` - разрешено ли выбирать несинхронизированную реплику в качестве нового лидера в случае сбоя текущего лидера. При true, kafka может выбирать в качестве лидера реплику, не синхронизированную с последним лидером(на стороне брокера)

  - Реплики делятся на in-sync и not in-sync, если реплика содержит все последние записи, подтвержденные лидерм - она in-sync. Реплики, которые отстают от лидера и не содержат всех последних записей - not in-sync