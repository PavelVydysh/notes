### 4.1. Пароли как ключевой элемент аутентификации

- Пароль — основной секрет, подтверждающий личность пользователя.
- Главная цель — сделать так, чтобы пароль никогда не хранился и не передавался в открытом виде.
- При компрометации базы данных или логов пароли в незашифрованном виде сразу раскрывают доступ к системе.

### 4.2. Алгоритмы защиты паролей
Spring Security поддерживает несколько алгоритмов хеширования:

- BCrypt — дефолтный алгоритм, основанный на адаптивной функции с солью, устойчивой к атакам перебора.
- PBKDF2 — алгоритм с регулируемой сложностью, подходит для многих корпоративных приложений.
- SCrypt и Argon2 — современные алгоритмы, обеспечивающие дополнительную защиту от аппаратных атак (GPU/ASIC).

Все алгоритмы используют соль и множество итераций, что делает подбор значительно сложнее.

### 4.3. Контракт PasswordEncoder
Основные методы:

- encode(CharSequence rawPassword) → возвращает зашифрованное значение;
- matches(CharSequence rawPassword, String encodedPassword) → проверяет соответствие.

Пример использования BCrypt:

```java
@Bean
public PasswordEncoder passwordEncoder() {
    return new BCryptPasswordEncoder();
}
```

### 4.4. Механизм делегирования паролей
Spring Security 5+ поддерживает DelegatingPasswordEncoder:

- позволяет хранить пароли в разных форматах;
- префикс в строке пароля указывает, какой алгоритм применён (например, {bcrypt}, {pbkdf2}).
- полезен при миграции с одного алгоритма на другой.

Пример:

```java
@Bean
public PasswordEncoder passwordEncoder() {
    return PasswordEncoderFactories.createDelegatingPasswordEncoder();
}
```

### 4.5. Обновление и миграция паролей

При входе пользователя система может обнаружить устаревший формат пароля.
После успешной аутентификации пароль можно автоматически пересчитать и сохранить в новом формате.
Это обеспечивает постепенную миграцию без необходимости сброса паролей для всех пользователей.

### 4.6. Лучшие практики хранения паролей

Всегда использовать адаптивные алгоритмы с солью.
Не хранить пароли в логах и дампах памяти.
Регулярно обновлять алгоритмы и параметры (число итераций).
Разделять секреты пользователей и системные секреты (ключи API, сертификаты) и хранить последние в хранилищах типа Vault.

### Ключевые выводы главы

- Пароль должен храниться только в виде хеша, устойчивого к атакам перебора.
- В Spring Security рекомендуется BCryptPasswordEncoder или делегирующий механизм.
- DelegatingPasswordEncoder обеспечивает поддержку нескольких алгоритмов и плавную миграцию.
- Обновление алгоритмов — необходимая часть долгосрочной стратегии безопасности.